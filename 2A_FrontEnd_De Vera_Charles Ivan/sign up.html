<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sign Up - Kushy Gadget Hub</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #D4AF37;
            --secondary-color: #222222;
            --accent-color: #FF9BB3;
            --text-light: #FFFFFF;
            --text-dark: #333333;
            --bg-dark: #1A1A1A;
            --bg-light: #f8f9fa;
            --bg-gold-gradient: linear-gradient(135deg, #D4AF37 0%, #F5E8A9 50%, #D4AF37 100%);
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-light);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .navbar {
            background: var(--bg-dark);
            border-bottom: 3px solid var(--primary-color);
            padding: 15px 0;
        }

        .navbar-brand {
            font-weight: 700;
            font-size: 1.5rem;
            color: var(--primary-color) !important;
            letter-spacing: 1px;
        }

        .signup-container {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 60px 0;
            background: url('https://api.placeholder/1920/1080') center/cover no-repeat;
            position: relative;
        }

        .signup-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1;
        }

        .signup-card {
            max-width: 550px;
            width: 100%;
            border-radius: 15px;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.2);
            overflow: hidden;
            background-color: white;
            position: relative;
            z-index: 2;
            border: none;
        }

        .signup-header {
            background: var(--bg-gold-gradient);
            color: var(--bg-dark);
            padding: 25px 20px;
            text-align: center;
            position: relative;
        }

        .signup-header h3 {
            font-weight: 700;
            margin-bottom: 5px;
            font-size: 1.75rem;
        }

        .signup-header p {
            opacity: 0.8;
            font-size: 1rem;
        }

        .signup-body {
            padding: 40px 30px;
        }

        .form-control {
            padding: 12px 15px;
            border-radius: 8px;
            border: 1px solid #ddd;
            transition: all 0.3s ease;
        }

        .form-control:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(212, 175, 55, 0.2);
        }

        .form-label {
            font-weight: 500;
            color: var(--text-dark);
            margin-bottom: 8px;
        }

        .btn-primary {
            background: var(--primary-color);
            border: none;
            padding: 12px 20px;
            font-weight: 600;
            border-radius: 8px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(212, 175, 55, 0.3);
        }

        .btn-primary:hover {
            background-color: #c09c2c;
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(192, 156, 44, 0.4);
        }

        .btn-link {
            color: var(--primary-color);
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .btn-link:hover {
            color: #c09c2c;
            text-decoration: underline !important;
        }

        .footer {
            background: var(--bg-dark);
            color: var(--text-light);
            padding: 25px 0;
            margin-top: auto;
            border-top: 3px solid var(--primary-color);
        }

        .footer a {
            color: var(--text-light);
            transition: color 0.3s ease;
            text-decoration: none;
        }

        .footer a:hover {
            color: var(--primary-color);
        }

        .divider {
            display: flex;
            align-items: center;
            margin: 20px 0;
            color: #6c757d;
        }

        .divider::before,
        .divider::after {
            content: '';
            flex: 1;
            border-bottom: 1px solid #dee2e6;
        }

        .divider span {
            padding: 0 15px;
            font-size: 0.9rem;
        }

        .social-signup {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .social-btn {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            color: white;
            transition: all 0.3s ease;
        }

        .social-btn.fb {
            background-color: #3b5998;
        }

        .social-btn.google {
            background-color: #dd4b39;
        }

        .social-btn.apple {
            background-color: #000;
        }

        .social-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .password-criteria {
            margin-top: 10px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 8px;
            font-size: 0.85rem;
        }

        .password-criteria ul {
            padding-left: 20px;
            margin-bottom: 0;
        }

        .password-criteria li {
            margin-bottom: 5px;
        }

        .password-criteria li:last-child {
            margin-bottom: 0;
        }

        .password-criteria .valid {
            color: #198754;
        }

        .password-criteria .invalid {
            color: #dc3545;
        }

        .form-text {
            font-size: 0.85rem;
            color: #6c757d;
        }

        .input-group-text {
            background-color: #f8f9fa;
            border-color: #ddd;
        }

        /* Custom checkbox styling */
        .form-check-input {
            width: 1.2em;
            height: 1.2em;
            margin-top: 0.15em;
        }

        .form-check-input:checked {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }

        .form-check-label {
            font-size: 0.9rem;
        }

        /* Progress steps */
        .signup-progress {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
        }

        .progress-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            z-index: 1;
            flex: 1;
            max-width: 100px;
        }

        .step-circle {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: #f8f9fa;
            border: 2px solid #ddd;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: #6c757d;
            margin-bottom: 8px;
            position: relative;
            z-index: 2;
        }

        .step-circle.active {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
            color: white;
        }

        .step-circle.completed {
            background-color: #198754;
            border-color: #198754;
            color: white;
        }

        .step-title {
            font-size: 0.8rem;
            color: #6c757d;
            text-align: center;
        }

        .progress-step:not(:last-child)::after {
            content: '';
            position: absolute;
            top: 20px;
            left: 50%;
            width: 100%;
            height: 2px;
            background-color: #ddd;
            z-index: 1;
        }

        .progress-step.completed:not(:last-child)::after {
            background-color: #198754;
        }

        /* Form step visibility */
        .step-content {
            display: none;
        }

        .step-content.active {
            display: block;
        }

        /* Firebase auth styles */
        .auth-error {
            color: #dc3545;
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
            border-radius: 4px;
            padding: 10px;
            margin-bottom: 15px;
            display: none;
        }

        .auth-success {
            color: #198754;
            background-color: #d1e7dd;
            border: 1px solid #badbcc;
            border-radius: 4px;
            padding: 10px;
            margin-bottom: 15px;
            display: none;
        }

        .loader {
            display: none;
            text-align: center;
            margin: 20px 0;
        }

        .loader .spinner-border {
            color: var(--primary-color);
        }
    </style>
</head>

<body>
    <!-- Navigation Bar -->
    <nav class="navbar sticky-top">
        <div class="container">
            <a class="navbar-brand" href="index.html">
                <i class="fas fa-mobile-alt me-2"></i> KGH HUB
            </a>
        </div>
    </nav>

    <!-- Signup Container -->
    <div class="signup-container">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-md-8">
                    <div class="signup-card">
                        <div class="signup-header">
                            <h3>Create Your Account</h3>
                            <p class="mb-0">Join the Kushy Gadget Hub community</p>
                        </div>
                        <div class="signup-body">
                            <!-- Alert Messages -->
                            <div id="auth-error" class="auth-error"></div>
                            <div id="auth-success" class="auth-success"></div>
                            <div id="loader" class="loader">
                                <div class="spinner-border" role="status">
                                    <span class="visually-hidden">Loading...</span>
                                </div>
                                <p class="mt-2">Creating your account...</p>
                            </div>

                            <!-- Progress Steps -->
                            <div class="signup-progress mb-4">
                                <div class="progress-step">
                                    <div class="step-circle active">1</div>
                                    <div class="step-title">Account</div>
                                </div>
                                <div class="progress-step">
                                    <div class="step-circle">2</div>
                                    <div class="step-title">Personal</div>
                                </div>
                                <div class="progress-step">
                                    <div class="step-circle">3</div>
                                    <div class="step-title">Preferences</div>
                                </div>
                            </div>

                            <!-- Social Signup -->
                            <div class="social-signup">
                                <button id="googleSignIn" class="social-btn google"><i
                                        class="fab fa-google"></i></button>
                                <button id="facebookSignIn" class="social-btn fb"><i
                                        class="fab fa-facebook-f"></i></button>
                            </div>

                            <div class="divider">
                                <span>OR SIGN UP WITH EMAIL</span>
                            </div>

                            <!-- Signup Form -->
                            <form id="signupForm">
                                <!-- Step 1: Account Information -->
                                <div class="step-content active" id="step1">
                                    <div class="mb-3">
                                        <label for="email" class="form-label">Email Address</label>
                                        <div class="input-group">
                                            <span class="input-group-text"><i class="fas fa-envelope"></i></span>
                                            <input type="email" class="form-control" id="email"
                                                placeholder="Enter your email" required>
                                        </div>
                                        <div class="form-text">We'll never share your email with anyone else.</div>
                                    </div>

                                    <div class="mb-3">
                                        <label for="password" class="form-label">Password</label>
                                        <div class="input-group">
                                            <span class="input-group-text"><i class="fas fa-lock"></i></span>
                                            <input type="password" class="form-control" id="password"
                                                placeholder="Create a password" required>
                                            <button class="btn btn-outline-secondary" type="button" id="togglePassword">
                                                <i class="fas fa-eye"></i>
                                            </button>
                                        </div>

                                        <div class="password-criteria mt-2">
                                            <p class="mb-2 fw-bold">Password must contain:</p>
                                            <ul>
                                                <li id="length" class="invalid">At least 8 characters</li>
                                                <li id="uppercase" class="invalid">At least one uppercase letter</li>
                                                <li id="lowercase" class="invalid">At least one lowercase letter</li>
                                                <li id="number" class="invalid">At least one number</li>
                                                <li id="special" class="invalid">At least one special character</li>
                                            </ul>
                                        </div>
                                    </div>

                                    <div class="mb-4">
                                        <label for="confirmPassword" class="form-label">Confirm Password</label>
                                        <div class="input-group">
                                            <span class="input-group-text"><i class="fas fa-lock"></i></span>
                                            <input type="password" class="form-control" id="confirmPassword"
                                                placeholder="Confirm your password" required>
                                        </div>
                                    </div>

                                    <div class="d-flex justify-content-between mt-4">
                                        <a href="login_page.html" class="btn btn-link text-decoration-none">Already have
                                            an
                                            account?</a>
                                        <button type="button" class="btn btn-primary next-step" data-next="step2">Next
                                            Step</button>
                                    </div>
                                </div>

                                <!-- Step 2: Personal Information -->
                                <div class="step-content" id="step2">
                                    <div class="row mb-3">
                                        <div class="col-md-6 mb-3 mb-md-0">
                                            <label for="firstName" class="form-label">First Name</label>
                                            <div class="input-group">
                                                <span class="input-group-text"><i class="fas fa-user"></i></span>
                                                <input type="text" class="form-control" id="firstName"
                                                    placeholder="Enter first name" required>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <label for="lastName" class="form-label">Last Name</label>
                                            <div class="input-group">
                                                <span class="input-group-text"><i class="fas fa-user"></i></span>
                                                <input type="text" class="form-control" id="lastName"
                                                    placeholder="Enter last name" required>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="mb-3">
                                        <label for="phone" class="form-label">Phone Number</label>
                                        <div class="input-group">
                                            <span class="input-group-text"><i class="fas fa-phone"></i></span>
                                            <input type="tel" class="form-control" id="phone"
                                                placeholder="Enter phone number" required>
                                        </div>
                                    </div>

                                    <div class="mb-4">
                                        <label for="birthdate" class="form-label">Date of Birth</label>
                                        <div class="input-group">
                                            <span class="input-group-text"><i class="fas fa-calendar"></i></span>
                                            <input type="date" class="form-control" id="birthdate" required>
                                        </div>
                                    </div>

                                    <div class="d-flex justify-content-between mt-4">
                                        <button type="button" class="btn btn-outline-secondary prev-step"
                                            data-prev="step1">Previous</button>
                                        <button type="button" class="btn btn-primary next-step" data-next="step3">Next
                                            Step</button>
                                    </div>
                                </div>

                                <!-- Step 3: Preferences -->
                                <div class="step-content" id="step3">
                                    <div class="mb-4">
                                        <label class="form-label">Preferred Product Categories</label>
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="form-check mb-2">
                                                    <input class="form-check-input" type="checkbox" id="smartphones">
                                                    <label class="form-check-label"
                                                        for="smartphones">Smartphones</label>
                                                </div>
                                                <div class="form-check mb-2">
                                                    <input class="form-check-input" type="checkbox" id="laptops">
                                                    <label class="form-check-label" for="laptops">Laptops &
                                                        Computers</label>
                                                </div>
                                                <div class="form-check mb-2">
                                                    <input class="form-check-input" type="checkbox" id="audio">
                                                    <label class="form-check-label" for="audio">Audio Devices</label>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="form-check mb-2">
                                                    <input class="form-check-input" type="checkbox" id="wearables">
                                                    <label class="form-check-label" for="wearables">Wearables</label>
                                                </div>
                                                <div class="form-check mb-2">
                                                    <input class="form-check-input" type="checkbox" id="accessories">
                                                    <label class="form-check-label"
                                                        for="accessories">Accessories</label>
                                                </div>
                                                <div class="form-check mb-2">
                                                    <input class="form-check-input" type="checkbox" id="gaming">
                                                    <label class="form-check-label" for="gaming">Gaming</label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="mb-4">
                                        <label class="form-label">Communication Preferences</label>
                                        <div class="form-check mb-2">
                                            <input class="form-check-input" type="checkbox" id="emailUpdates" checked>
                                            <label class="form-check-label" for="emailUpdates">
                                                Receive email updates about new products and deals
                                            </label>
                                        </div>
                                        <div class="form-check mb-2">
                                            <input class="form-check-input" type="checkbox" id="smsUpdates">
                                            <label class="form-check-label" for="smsUpdates">
                                                Receive SMS notifications about exclusive offers
                                            </label>
                                        </div>
                                    </div>

                                    <div class="mb-4">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="termsAgree" required>
                                            <label class="form-check-label" for="termsAgree">
                                                I agree to the <a href="terms.html" class="text-decoration-none">Terms
                                                    of Service</a> and <a href="privacy.html"
                                                    class="text-decoration-none">Privacy Policy</a>
                                            </label>
                                        </div>
                                    </div>

                                    <div class="d-flex justify-content-between mt-4">
                                        <button type="button" class="btn btn-outline-secondary prev-step"
                                            data-prev="step2">Previous</button>
                                        <button type="submit" class="btn btn-primary">Create Account</button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="row">
                <div class="col-md-6 text-center text-md-start">
                    <p class="mb-0">&copy; 2025 Kushy Gadget Hub. All rights reserved.</p>
                </div>
                <div class="col-md-6 text-center text-md-end">
                    <ul class="list-inline mb-0">
                        <li class="list-inline-item me-3"><a href="terms.html">Terms of Service</a></li>
                        <li class="list-inline-item"><a href="privacy.html">Privacy Policy</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </footer>

    <!-- Bootstrap JS Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Firebase App (the core Firebase SDK) -->
    <script src="https://www.gstatic.com/firebasejs/9.19.1/firebase-app-compat.js"></script>
    <!-- Firebase Auth -->
    <script src="https://www.gstatic.com/firebasejs/9.19.1/firebase-auth-compat.js"></script>
    <!-- Firebase Firestore -->
    <script src="https://www.gstatic.com/firebasejs/9.19.1/firebase-firestore-compat.js"></script>

    <!-- Custom JS -->
    <script>
        import { initializeApp } from "firebase/app";
        import { getAnalytics } from "firebase/analytics";
        // Wait for DOM to be fully loaded
        document.addEventListener('DOMContentLoaded', function () {
            // Firebase configuration
            const firebaseConfig = {
                apiKey: "AIzaSyAoMigjt6vI20hsqWy71YRKTSTut0NeM9Y",
                authDomain: "kgh-hub.firebaseapp.com",
                projectId: "kgh-hub",
                storageBucket: "kgh-hub.firebasestorage.app",
                messagingSenderId: "855033685100",
                appId: "1:855033685100:web:a3e3b995507c6315a52449",
                measurementId: "G-H31F0G6SER"
            };

            // Initialize Firebase (using compat version)
            firebase.initializeApp(firebaseConfig);
            const auth = firebase.auth();
            const db = firebase.firestore();

            // Get elements
            const authError = document.getElementById('auth-error');
            const authSuccess = document.getElementById('auth-success');
            const loader = document.getElementById('loader');
            const signupForm = document.getElementById('signupForm');

            // Show error message
            function showError(message) {
                authError.textContent = message;
                authError.style.display = 'block';
                authSuccess.style.display = 'none';
                loader.style.display = 'none';
            }

            // Show success message
            function showSuccess(message) {
                authSuccess.textContent = message;
                authSuccess.style.display = 'block';
                authError.style.display = 'none';
                loader.style.display = 'none';
            }

            // Show loader
            function showLoader() {
                loader.style.display = 'block';
                authError.style.display = 'none';
                authSuccess.style.display = 'none';
            }

            // Hide messages
            function hideMessages() {
                authError.style.display = 'none';
                authSuccess.style.display = 'none';
                loader.style.display = 'none';
            }

            // Social sign-in handlers
            document.getElementById('googleSignIn').addEventListener('click', function () {
                showLoader();
                const provider = new firebase.auth.GoogleAuthProvider();
                auth.signInWithPopup(provider)
                    .then((result) => {
                        // Store additional user data in Firestore
                        storeUserData(result.user, { signUpMethod: 'google' });
                    })
                    .catch((error) => {
                        showError(error.message);
                    });
            });

            document.getElementById('facebookSignIn').addEventListener('click', function () {
                showLoader();
                const provider = new firebase.auth.FacebookAuthProvider();
                auth.signInWithPopup(provider)
                    .then((result) => {
                        // Store additional user data in Firestore
                        storeUserData(result.user, { signUpMethod: 'facebook' });
                    })
                    .catch((error) => {
                        showError(error.message);
                    });
            });

            document.getElementById('appleSignIn').addEventListener('click', function () {
                showLoader();
                const provider = new firebase.auth.OAuthProvider('apple.com');
                auth.signInWithPopup(provider)
                    .then((result) => {
                        // Store additional user data in Firestore
                        storeUserData(result.user, { signUpMethod: 'apple' });
                    })
                    .catch((error) => {
                        showError(error.message);
                    });
            });

            // Function to store user data in Firestore
            function storeUserData(user, additionalData = {}) {
                // For social sign-ins, we might not have all the data yet
                const userData = {
                    uid: user.uid,
                    email: user.email,
                    displayName: user.displayName || '',
                    phoneNumber: user.phoneNumber || '',
                    photoURL: user.photoURL || '',
                    emailVerified: user.emailVerified,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    ...additionalData
                };

                // Store in Firestore
                db.collection('users').doc(user.uid).set(userData, { merge: true })
                    .then(() => {
                        showSuccess('Account created successfully! Redirecting to dashboard...');
                        setTimeout(() => {
                            window.location.href = 'dashboard.html';
                        }, 2000);
                    })
                    .catch((error) => {
                        showError('Error storing user data: ' + error.message);
                    });
            }


            // Multi-step form navigation
            const nextButtons = document.querySelectorAll('.next-step');
            const prevButtons = document.querySelectorAll('.prev-step');
            const steps = document.querySelectorAll('.step-content');
            const progressSteps = document.querySelectorAll('.progress-step');

            // Next button click handler
            nextButtons.forEach(button => {
                button.addEventListener('click', function () {
                    // If moving from step 1, validate email and password
                    if (this.getAttribute('data-next') === 'step2') {
                        const email = document.getElementById('email').value;
                        const password = document.getElementById('password').value;
                        const confirmPassword = document.getElementById('confirmPassword').value;

                        // Basic email validation
                        if (!email || !/\S+@\S+\.\S+/.test(email)) {
                            showError('Please enter a valid email address.');
                            return;
                        }

                        // Check if password meets criteria
                        if (!isPasswordValid(password)) {
                            showError('Your password does not meet the requirements.');
                            return;
                        }

                        // Check if passwords match
                        if (password !== confirmPassword) {
                            showError('Passwords do not match.');
                            return;
                        }

                        hideMessages();
                    }

                    const nextStep = this.getAttribute('data-next');

                    // Hide all steps
                    steps.forEach(step => step.classList.remove('active'));

                    // Show the target step
                    document.getElementById(nextStep).classList.add('active');

                    // Update progress steps
                    const stepIndex = parseInt(nextStep.replace('step', '')) - 1;
                    updateProgressSteps(stepIndex);
                });
            });

            // Previous button click handler
            prevButtons.forEach(button => {
                button.addEventListener('click', function () {
                    const prevStep = this.getAttribute('data-prev');

                    // Hide all steps
                    steps.forEach(step => step.classList.remove('active'));

                    // Show the target step
                    document.getElementById(prevStep).classList.add('active');

                    // Update progress steps
                    const stepIndex = parseInt(prevStep.replace('step', '')) - 1;
                    updateProgressSteps(stepIndex);
                });
            });

            // Update progress steps
            function updateProgressSteps(activeIndex) {
                progressSteps.forEach((step, index) => {
                    const stepCircle = step.querySelector('.step-circle');
                    stepCircle.classList.remove('active', 'completed');

                    if (index < activeIndex) {
                        stepCircle.classList.add('completed');
                        stepCircle.innerHTML = '<i class="fas fa-check"></i>';
                    } else if (index === activeIndex) {
                        stepCircle.classList.add('active');
                        stepCircle.textContent = index + 1;
                    } else {
                        stepCircle.textContent = index + 1;
                    }
                });
            }

            // Password visibility toggle
            const togglePassword = document.getElementById('togglePassword');
            const passwordInput = document.getElementById('password');

            togglePassword.addEventListener('click', function () {
                const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
                passwordInput.setAttribute('type', type);

                // Toggle eye icon
                this.querySelector('i').classList.toggle('fa-eye');
                this.querySelector('i').classList.toggle('fa-eye-slash');
            });

            // Password strength checker
            const password = document.getElementById('password');
            const length = document.getElementById('length');
            const uppercase = document.getElementById('uppercase');
            const lowercase = document.getElementById('lowercase');
            const number = document.getElementById('number');
            const special = document.getElementById('special');

            password.addEventListener('input', function () {
                const value = this.value;

                // Check length
                if (value.length >= 8) {
                    length.classList.remove('invalid');
                    length.classList.add('valid');
                } else {
                    length.classList.remove('valid');
                    length.classList.add('invalid');
                }

                // Check uppercase
                if (/[A-Z]/.test(value)) {
                    uppercase.classList.remove('invalid');
                    uppercase.classList.add('valid');
                } else {
                    uppercase.classList.remove('valid');
                    uppercase.classList.add('invalid');
                }

                // Check lowercase
                if (/[a-z]/.test(value)) {
                    lowercase.classList.remove('invalid');
                    lowercase.classList.add('valid');
                } else {
                    lowercase.classList.remove('valid');
                    lowercase.classList.add('invalid');
                }

                // Check number
                if (/\d/.test(value)) {
                    number.classList.remove('invalid');
                    number.classList.add('valid');
                } else {
                    number.classList.remove('valid');
                    number.classList.add('invalid');
                }

                // Check special character
                if (/[!@#$%^&*(),.?":{}|<>]/.test(value)) {
                    special.classList.remove('invalid');
                    special.classList.add('valid');
                } else {
                    special.classList.remove('valid');
                    special.classList.add('invalid');
                }
            });

            // Function to check if password meets all criteria
            function isPasswordValid(password) {
                return (
                    password.length >= 8 &&
                    /[A-Z]/.test(password) &&
                    /[a-z]/.test(password) &&
                    /\d/.test(password) &&
                    /[!@#$%^&*(),.?":{}|<>]/.test(password)
                );
            }

            // Form submission - Create account with Firebase
            signupForm.addEventListener('submit', function (event) {
                event.preventDefault();

                // Check if on the final step
                if (!document.getElementById('step3').classList.contains('active')) {
                    return;
                }

                // Get email and password from form
                const email = document.getElementById('email').value;
                const password = document.getElementById('password').value;
                const confirmPassword = document.getElementById('confirmPassword').value;

                if (password !== confirmPassword) {
                    showError('Passwords do not match!');
                    return;
                }

                // Check terms agreement
                const termsAgree = document.getElementById('termsAgree').checked;
                if (!termsAgree) {
                    showError('You must agree to the Terms of Service and Privacy Policy.');
                    return;
                }

                // Show loader during authentication
                showLoader();

                // Create user with Firebase Authentication
                auth.createUserWithEmailAndPassword(email, password)
                    .then((userCredential) => {
                        // Collect all form data
                        const userData = {
                            uid: userCredential.user.uid,
                            email: email,
                            firstName: document.getElementById('firstName').value,
                            lastName: document.getElementById('lastName').value,
                            phone: document.getElementById('phone').value,
                            birthdate: document.getElementById('birthdate').value,
                            signUpMethod: 'email',
                            preferences: {
                                smartphones: document.getElementById('smartphones').checked,
                                laptops: document.getElementById('laptops').checked,
                                audio: document.getElementById('audio').checked,
                                wearables: document.getElementById('wearables').checked,
                                accessories: document.getElementById('accessories').checked,
                                gaming: document.getElementById('gaming').checked
                            },
                            communication: {
                                email: document.getElementById('emailUpdates').checked,
                                sms: document.getElementById('smsUpdates').checked
                            },
                            termsAccepted: true,
                            createdAt: firebase.firestore.FieldValue.serverTimestamp()
                        };

                        // Set display name for the user profile
                        userCredential.user.updateProfile({
                            displayName: `${userData.firstName} ${userData.lastName}`
                        }).then(() => {
                            console.log('User profile updated');
                        }).catch((error) => {
                            console.error('Error updating profile:', error);
                        });

                        // Store user data in Firestore
                        db.collection('users').doc(userCredential.user.uid).set(userData)
                            .then(() => {
                                // Send verification email
                                userCredential.user.sendEmailVerification()
                                    .then(() => {
                                        showSuccess('Account created successfully! Please check your email to verify your account.');
                                        // Clear the form
                                        signupForm.reset();
                                        // Redirect to login page after 3 seconds
                                        setTimeout(function () {
                                            window.location.href = 'login.html';
                                        }, 3000);
                                    })
                                    .catch((error) => {
                                        showSuccess('Account created successfully! You can now log in.');
                                        console.error('Error sending verification email:', error);
                                        // Redirect anyway
                                        setTimeout(function () {
                                            window.location.href = 'login.html';
                                        }, 3000);
                                    });
                            })
                            .catch((error) => {
                                showError('Error storing user data: ' + error.message);
                            });
                    })
                    .catch((error) => {
                        // Handle errors
                        let errorMessage = error.message;

                        // Provide more user-friendly error messages
                        if (error.code === 'auth/email-already-in-use') {
                            errorMessage = 'This email is already registered. Please log in or use a different email.';
                        } else if (error.code === 'auth/invalid-email') {
                            errorMessage = 'Please enter a valid email address.';
                        } else if (error.code === 'auth/weak-password') {
                            errorMessage = 'Your password is too weak. Please choose a stronger password.';
                        }

                        showError(errorMessage);
                    });
            });

            // Listen for auth state changes
            auth.onAuthStateChanged(function (user) {
                if (user) {
                    // User is signed in
                    console.log('User is signed in:', user.uid);

                    // If the user is already signed in and on the signup page, redirect to dashboard
                    if (window.location.pathname.includes('signup') && !window.location.search.includes('force=true')) {
                        window.location.href = 'dashboard.html';
                    }
                } else {
                    // User is signed out
                    console.log('No user is signed out.');
                }
            });
        });
    </script>